# MD500E 变频器控制系统项目说明文档 📋

## 📖 项目概述

**MD500E** 是一个基于 **TMS320F28035 DSP** 的工业级变频器控制系统，专为电机驱动控制而设计。该项目采用模块化架构，支持多种电机类型和控制算法，具备完整的工业通信协议和保护功能。

### 🎯 项目特点
- ✅ **实时性强** - 精确的0.5ms/2ms定时任务调度
- ✅ **功能完整** - 支持多种电机类型和控制方式
- ✅ **工业级** - 具备完整的通信协议和保护功能
- ✅ **可扩展** - 支持不同电压等级和功率等级
- ✅ **模块化** - 清晰的层次结构，便于维护

---

## 🏗️ 系统架构

### 📁 目录结构
```
MD500E/
├── 🖥️  01_system/          # 系统层 - DSP底层驱动和初始化
├── ⚡ 02_motor/           # 电机控制层 - 核心控制算法
├── 🔧 04_subprogram/      # 子程序 - 汇编和C混合编程
├── 📚 05_public/          # 公共资源 - 头文件、库文件
├── 🌐 func/               # 功能层 - 通信、参数管理
├── 📦 include_ti/         # TI官方头文件
└── 🛠️  CCs_28035/         # CCS工程文件
```

### 🔄 软件层次结构

```
┌─────────────────────────────────────┐
│          应用层 (Application)        │
├─────────────────────────────────────┤
│        功能层 (Function)            │
├─────────────────────────────────────┤
│        电机控制层 (Motor)           │
├─────────────────────────────────────┤
│        系统层 (System)              │
├─────────────────────────────────────┤
│        硬件抽象层 (HAL)             │
└─────────────────────────────────────┘
```

---

## ⚙️ 核心模块分析

### 🖥️ 系统层 (01_system/)
**功能**: DSP底层驱动、系统初始化、中断管理

| 文件 | 功能描述 |
|------|----------|
| `main.c` | 🎯 主程序入口，实现定时任务调度 |
| `mainInit_2803x.c` | 🔧 系统初始化配置 |
| `DSP2803x_*.c` | 📡 DSP外设驱动 |

### ⚡ 电机控制层 (02_motor/)
**功能**: 核心控制算法实现

#### 📂 子模块结构
```
02_motor/
├── 🔄 encoder/           # 编码器处理
├── 🎛️ main_public/       # 电机控制主程序
├── 📊 para_estimation/   # 参数估计
├── ⚡ pwm/               # PWM控制
├── 🎯 vc/               # 矢量控制
└── 📈 vf/               # V/F控制
```

#### 🎛️ 控制算法支持
- **SVC** 🎯 - 空间矢量控制
- **FVC** 🧲 - 磁场矢量控制
- **VF** 📈 - V/F控制
- **IPM** 🔧 - 内置永磁体控制

### 🌐 功能层 (func/)
**功能**: 通信协议、参数管理、人机界面

| 模块 | 功能 |
|------|------|
| `f_comm.c` | 📡 通信协议处理 |
| `f_eeprom.c` | 💾 参数存储管理 |
| `f_ui.c` | 🖥️ 人机界面 |
| `f_error.c` | ⚠️ 故障处理 |

---

## 🔄 实时任务调度

### ⏰ 任务调度架构
```c
// 0.5ms 高优先级任务
Main05msMotor();           // 🎯 电机控制核心算法
Main05msFunctionA/B/C/D(); // 🌐 功能模块处理

// 2ms 中优先级任务  
Main2msMotorA/B/C/D();     // ⚡ 电机控制辅助任务

// 0ms 后台任务
Main0msFunction();         // 🔧 非实时功能处理
```

### 📊 任务时序图
```
时间轴: 0ms ── 0.5ms ── 1ms ── 1.5ms ── 2ms
        │      │        │      │        │
任务A:  ──────┼────────┼──────┼────────┼──────
任务B:        ──────┼────────┼──────┼────────
任务C:              ──────┼────────┼──────
任务D:                    ──────┼────────
```

---

## 🎯 控制算法详解

### 🧲 电机类型支持
| 电机类型 | 代码 | 描述 |
|----------|------|------|
| 🌀 异步电机 | `MOTOR_TYPE_IM` | 感应电机 |
| 🔧 永磁同步电机 | `MOTOR_TYPE_PM` | PMSM |
| ⚡ 变频异步电机 | `MOTOR_TYPE_VARFREQ` | 变频电机 |

### 🎛️ 控制方式
| 控制方式 | 代码 | 应用场景 |
|----------|------|----------|
| 🎯 空间矢量控制 | `IDC_SVC_CTL` | 高性能控制 |
| 🧲 磁场矢量控制 | `IDC_FVC_CTL` | 精确转矩控制 |
| 📈 V/F控制 | `IDC_VF_CTL` | 简单应用 |

### ⚡ 电压等级支持
- 🔌 **220V** - 低压应用
- 🔌 **380V** - 标准工业电压
- 🔌 **480V** - 北美标准
- 🔌 **690V** - 中压应用
- 🔌 **1140V** - 高压应用

---

## 🌐 通信协议

### 📡 支持的通信接口
| 协议 | 文件 | 功能 |
|------|------|------|
| 🚌 CAN总线 | `f_canlink.c` | 工业现场总线 |
| 📋 Modbus | `f_modbus.c` | 标准工业协议 |
| 🔗 Profibus | `f_profibus.c` | 过程现场总线 |
| 🔗 P2P | `f_p2p.c` | 点对点通信 |

### 🔧 通信特性
- ✅ **实时性** - 快速响应
- ✅ **可靠性** - 错误检测和重传
- ✅ **兼容性** - 标准工业协议
- ✅ **扩展性** - 支持多种协议

---

## 🛡️ 保护功能

### ⚠️ 保护类型
| 保护类型 | 功能描述 | 响应时间 |
|----------|----------|----------|
| 🔥 过流保护 | 检测电流超限 | < 1ms |
| ⚡ 过压保护 | 检测电压超限 | < 1ms |
| 🔋 欠压保护 | 检测电压过低 | < 10ms |
| 🌡️ 过温保护 | 检测温度超限 | < 100ms |
| ⚡ 短路保护 | 检测短路故障 | < 0.1ms |

### 🔧 保护机制
```c
// 保护检测流程
检测故障 → 判断类型 → 执行保护 → 记录日志 → 恢复检测
```

---

## 🚀 高级功能

### ✈️ 飞车启动
- **功能**: 电机旋转状态下的启动
- **应用**: 风机、泵类负载
- **优势**: 减少启动冲击

### 🔧 参数自整定
- **功能**: 电机参数自动识别
- **支持**: 电阻、电感、磁链参数
- **精度**: 高精度参数估计

### 🧲 弱磁控制
- **功能**: 高速运行时的磁场控制
- **应用**: 高速电机控制
- **优势**: 扩展速度范围

### 🎯 零位控制
- **功能**: 位置控制功能
- **应用**: 伺服控制
- **精度**: 高精度位置控制

---

## 🛠️ 开发环境

### 💻 开发工具
- **IDE**: Code Composer Studio (CCS)
- **编译器**: TI C2000编译器
- **调试器**: XDS200仿真器

### ⚙️ 编译配置
```bash
# 编译器选项
-g -q -o3 -i"$(Proj_dir)\05_public\280_header" 
-i"$(Proj_dir)\05_public\motor_header" 
-i"$(Proj_dir)\05_public\function_header"  
-d"_DEBUG" -d"CHIP_2808L" -d"LARGE_MODEL" 
-ml -mt -v28

# 链接器选项
-q -c -m".\Debug\280X-DSP.map" 
-o".\Debug\280X-DSP.out" 
-stack0x400 -w -x
```

### 📊 内存配置
- **栈大小**: 0x400 (1KB)
- **堆大小**: 动态分配
- **代码段**: 程序存储
- **数据段**: 数据存储

---

## 📈 性能指标

### ⚡ 实时性能
| 指标 | 数值 | 说明 |
|------|------|------|
| 🎯 控制周期 | 0.5ms | 电机控制核心 |
| 📊 采样频率 | 2kHz | ADC采样 |
| ⚡ PWM频率 | 4kHz | PWM输出 |
| 🔄 任务调度 | 0.5ms | 系统调度 |

### 📊 控制精度
| 参数 | 精度 | 单位 |
|------|------|------|
| 🎯 速度控制 | ±0.1% | 额定速度 |
| 🔧 转矩控制 | ±2% | 额定转矩 |
| 📊 位置控制 | ±0.1° | 角度 |
| ⚡ 电流控制 | ±1% | 额定电流 |

---

## 🔧 部署指南

### 📋 编译步骤
1. 🔧 **环境准备**
   - 安装CCS开发环境
   - 配置TI编译器
   - 连接仿真器

2. 📦 **项目配置**
   - 导入项目文件
   - 配置编译选项
   - 设置链接参数

3. 🔨 **编译构建**
   - 清理项目
   - 编译代码
   - 生成目标文件

4. 📤 **程序下载**
   - 连接目标板
   - 下载程序
   - 验证运行

### ⚙️ 参数配置
```c
// 电机参数配置
#define MOTOR_TYPE_PM          // 电机类型
#define INV_VOLTAGE_380V       // 电压等级
#define IDC_SVC_CTL           // 控制方式

// 保护参数配置
#define OVER_CURRENT_LIMIT     // 过流限制
#define OVER_VOLTAGE_LIMIT     // 过压限制
#define OVER_TEMP_LIMIT        // 过温限制
```

---

## 📚 技术文档

### 📖 相关文档
- 📋 **用户手册** - 操作指南
- 🔧 **技术手册** - 技术细节
- 📊 **参数手册** - 参数说明
- ⚠️ **故障手册** - 故障处理

### 🔗 相关链接
- 🌐 **TI官网** - 芯片资料
- 📚 **技术论坛** - 技术支持
- 📖 **开发社区** - 经验分享

---

## 📞 技术支持

### 🆘 常见问题
1. **编译错误** - 检查编译器配置
2. **下载失败** - 检查仿真器连接
3. **运行异常** - 检查参数配置
4. **通信故障** - 检查协议设置

### 📧 联系方式
- 📧 **邮箱**: support@company.com
- 📞 **电话**: 400-xxx-xxxx
- 💬 **在线**: 技术支持QQ群

---

## 📄 版本信息

### 📋 版本历史
| 版本 | 日期 | 更新内容 |
|------|------|----------|
| v1.0 | 2024-01 | 🎉 初始版本发布 |
| v1.1 | 2024-02 | 🔧 功能优化 |
| v1.2 | 2024-03 | 🆕 新增功能 |

### 🔄 更新计划
- 📅 **v1.3** - 新增通信协议
- 📅 **v1.4** - 优化控制算法
- 📅 **v1.5** - 增强保护功能

---

*📝 文档版本: v1.0*  
*📅 最后更新: 2024年12月*  
*👨‍💻 维护人员: 技术团队* 